<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/profile-view/profile-view.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/profile-view/profile-view.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useEffect, useState } from "react";
import { useNavigate } from "react-router-dom";
import { Form, Button, Col, Row, Container } from "react-bootstrap";

/**
 *
 * @component
 * @param {Object} props - Component props
 * @param {string} props.token - JWT authentication token
 * @param {function():void} props.onLogout - Callback triggered after logout or account deletion
 * @param {Array&lt;{_id: string, title: string, imagePath: string, director: string, genre: string}>} props.movies - List of movies in the application
 * @param {React.ComponentType&lt;any>} props.MovieCard - Component used to render movie cards
 * @param {function(Object):void} props.onUserUpdate - Callback triggered after a successful profile update
 * @returns {ReactElement} The user's profile page
 */
const ProfileView = ({ token, onLogout, movies, MovieCard, onUserUpdate }) => {
    const navigate = useNavigate();

    const [user, setUser] = useState(null);
    const [formData, setFormData] = useState({
        Username: "",
        Password: "",
        Email: "",
        Birthday: "",
    });
    const [loading, setLoading] = useState(true);
    const [message, setMessage] = useState(null);
    const [error, setError] = useState(null);

    /**
       * Load the current user data from the API.
       *
       * @async
       * @function loadUser
       * @returns {Promise&lt;void>} Resolves when the user data has been loaded
       */
    const loadUser = async () => {
        const storedToken = localStorage.getItem("token");
        const storedUsername = localStorage.getItem("username");
        if (!storedToken || !storedUsername) return;

        try {
            const response = await fetch(
                `https://mytomhanksapp-3bff0bf9ef19.herokuapp.com/users/${storedUsername}`,
                { headers: { Authorization: `Bearer ${storedToken}` } }
            );
            if (!response.ok) throw new Error("Failed to fetch user");
            const data = await response.json();
            setUser(data);
            setFormData({
                Username: data.Username,
                Password: "",
                Email: data.Email,
                Birthday: data.Birthday ? data.Birthday.substring(0, 10) : "",
            });
            setLoading(false);
        } catch (err) {
            setError(err.message);
        }
    };

    useEffect(() => {
        loadUser();
    }, []);

    /**
     * Handle changes to form input fields and update component state.
     *
     * @function handleChange
     * @param {React.ChangeEvent&lt;HTMLInputElement>} e - Input change event
     * @returns {void}
     */
    const handleChange = (e) => {
        setFormData((prev) => ({ ...prev, [e.target.name]: e.target.value }));
    };


    /**
     * Handle profile update submission.
     * Sends updated data to the backend, updates localStorage, and updates the route.
     *
     * @async
     * @function handleUpdate
     * @param {React.FormEvent&lt;HTMLFormElement>} e - Form submission event
     * @returns {Promise&lt;void>}
     */
    const handleUpdate = async (e) => {
        e.preventDefault();
        setError(null);
        setMessage(null);
        if (!user) return;

        const currentUsername = localStorage.getItem("username");
        const payload = {
            Username: formData.Username,
            Email: formData.Email,
            Birthday: formData.Birthday,
        };
        if (formData.Password.trim()) payload.Password = formData.Password;

        try {
            const response = await fetch(
                `https://mytomhanksapp-3bff0bf9ef19.herokuapp.com/users/${currentUsername}`,
                {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${token}`,
                    },
                    body: JSON.stringify(payload),
                }
            );

            if (!response.ok) {
                const errData = await response.json();
                throw new Error(errData.message || "Failed to update user");
            }

            const updatedData = await response.json();

            // Update localStorage &amp; parent state
            localStorage.setItem("user", JSON.stringify(updatedData.user));
            localStorage.setItem("username", updatedData.user.Username);
            if (updatedData.token) localStorage.setItem("token", updatedData.token);
            onUserUpdate(updatedData.user);

            setUser(updatedData.user);
            setFormData((prev) => ({ ...prev, Password: "" }));
            setMessage("Profile updated successfully!");

            // Update URL for readability
            navigate(`/users/${updatedData.user.Username}`, { replace: true });
        } catch (err) {
            setError(err.message);
        }
    };

    /**
     * Handle user account deletion.
     * Sends a DELETE request to the backend, clears localStorage, and logs the user out.
     *
     * @async
     * @function handleDelete
     * @returns {Promise&lt;void>}
     */
    const handleDelete = async () => {
        if (!window.confirm("Are you sure you want to delete your account?")) return;

        const currentUsername = localStorage.getItem("username");
        try {
            const response = await fetch(
                `https://mytomhanksapp-3bff0bf9ef19.herokuapp.com/users/${currentUsername}`,
                { method: "DELETE", headers: { Authorization: `Bearer ${token}` } }
            );
            if (!response.ok) throw new Error("Failed to delete user");

            alert("Account deleted successfully.");
            localStorage.clear();
            onLogout();
        } catch (err) {
            setError(err.message);
        }
    };

    if (loading) return &lt;div>Loading profile...&lt;/div>;
    if (error) return &lt;div style={{ color: "red" }}>{error}&lt;/div>;

    const favoriteMovies = movies.filter((m) => user.FavoriteMovies?.includes(m._id));

    return (
        &lt;Container style={{ maxWidth: "960px" }}>
            &lt;h2>Your Profile&lt;/h2>
            {message &amp;&amp; &lt;p style={{ color: "green" }}>{message}&lt;/p>}

            &lt;Form onSubmit={handleUpdate}>
                &lt;Form.Label>
                    Username:
                    &lt;Form.Control name="Username" value={formData.Username} onChange={handleChange} required />
                &lt;/Form.Label>
                &lt;br />
                &lt;Form.Label>
                    Password (leave blank to keep current):
                    &lt;Form.Control type="password" name="Password" value={formData.Password} onChange={handleChange} placeholder="New password" />
                &lt;/Form.Label>
                &lt;br />
                &lt;Form.Label>
                    Email:
                    &lt;Form.Control type="email" name="Email" value={formData.Email} onChange={handleChange} required />
                &lt;/Form.Label>
                &lt;br />
                &lt;Form.Label>
                    Date of Birth:
                    &lt;Form.Control type="date" name="Birthday" value={formData.Birthday} onChange={handleChange} />
                &lt;/Form.Label>
                &lt;br />
                &lt;Button type="submit" variant="primary">Update Profile&lt;/Button>
            &lt;/Form>

            &lt;hr />
            &lt;h3>Your Favorite Movies&lt;/h3>
            &lt;Row className="g-4">
                {favoriteMovies.map((movie) => (
                    &lt;Col key={movie._id} xs={12} sm={6} md={4}>
                        &lt;div style={{ position: "relative", minHeight: "400px", display: "flex", flexDirection: "column" }}>
                            &lt;MovieCard movie={movie} />
                        &lt;/div>
                    &lt;/Col>
                ))}
            &lt;/Row>

            &lt;br />
            &lt;hr />
            &lt;Button variant="danger" onClick={handleDelete}>Deregister (Delete Account)&lt;/Button>
        &lt;/Container>
    );
};

export default ProfileView;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#App">App</a></li><li><a href="global.html#LoginView">LoginView</a></li><li><a href="global.html#MovieCard">MovieCard</a></li><li><a href="global.html#MovieView">MovieView</a></li><li><a href="global.html#ProfileView">ProfileView</a></li><li><a href="global.html#SignupView">SignupView</a></li><li><a href="global.html#clearFilter">clearFilter</a></li><li><a href="global.html#handleAddFavorite">handleAddFavorite</a></li><li><a href="global.html#handleBack">handleBack</a></li><li><a href="global.html#handleChange">handleChange</a></li><li><a href="global.html#handleDelete">handleDelete</a></li><li><a href="global.html#handleSubmit">handleSubmit</a></li><li><a href="global.html#handleUpdate">handleUpdate</a></li><li><a href="global.html#loadUser">loadUser</a></li><li><a href="global.html#moviesSlice">moviesSlice</a></li><li><a href="global.html#setDirectorFilter">setDirectorFilter</a></li><li><a href="global.html#setGenreFilter">setGenreFilter</a></li><li><a href="global.html#setMovies">setMovies</a></li><li><a href="global.html#store">store</a></li><li><a href="global.html#validate">validate</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sun Sep 28 2025 20:44:19 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
